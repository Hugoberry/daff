<html>
<head>
<title>Test</title>
<script src="lib/jquery.min.js"></script>
<script src="dist/jquery.handsontable.full.js"></script>
<script src="coopy/coopy.js"></script>
<script src="coopy/scripts/jtable.js"></script>
<link rel="stylesheet" media="screen" href="dist/jquery.handsontable.full.css">
</head>

<body>

<div style="display: float; float: right;">
  <div>
  <b>Row alignment</b><br />
  <div id="ordering"></div>
  </div>
  <div style="margin-top: 10px;">
  <b>Column alignment</b><br />
  <div id="column_ordering"></div>
  </div>
</div>

<div style="width:70%;">
  <form>
  <input id="parent_checkbox" type="checkbox" />Parent /
  <a id="button-clear" href="#">Clear</a>
  </form>
  <div id="block0" style="display: none;">
    <p>Parent</p>
    <div id="table0"></div>
  </div>
  <div id="block1">
    <p>Local</p>
    <div id="table1"></div>
  </div>
  <div id="block2">
    <p>Remote</p>
    <div id="table2"></div>
  </div>
</div>

<script>
var coopy = window;
var jtable = window;
var use_parent = false;
function processChange(changes,source,table) {
  var t1 = new jtable.JTable2(data1);
  var t2 = new jtable.JTable2(data2);
  t1.trim();
  t2.trim();
  var ct = new coopy.CompareTable();
  var comp = null;
  if (!use_parent) { 
    comp = coopy.Comparison.compareTables(ct,t1,t2);
  } else {
    var t0 = new jtable.JTable2(data0);
    t0.trim();
    comp = coopy.Comparison.compareTables3(ct,t0,t1,t2);
  }
  var align = ct.align();
  var order = align.toOrder();
  var report = order.toString().replace(/, */g,"<br />\n");
  report += "<br /><br />";
  report += (new coopy.TableDiff(align)).test().toString().replace(/, */g,"<br />\n");
  $("#ordering").html(report);
  var report2 = align.meta.toOrder().toString().replace(/, */g,"<br />\n");
  $("#column_ordering").html(report2);
}


      var data0 = 
	[
		[ "bridge", "designer", "length" ],
		[ "Brooklyn", "J. A. Roebling", "1595" ],
		[ "Williamsburg", "D. Duck", "1600" ],
		[ "Queensborough", "Palmer & Hornbostel", "1182" ],
		[ "Triborough", "O. H. Ammann", "1380,383" ],
		[ "Bronx Whitestone", "O. H. Ammann", "2300" ],
		[ "Throgs Neck", "O. H. Ammann", "1800" ],
		[ "George Washington", "O. H. Ammann", "3500" ],
		[ "Spamspan", "S. Spamington", "10000" ]
	];

      var data1 =
	[
		[ "bridge", "designer", "length" ],
		[ "Brooklyn", "J. A. Roebling", "1595" ],
		[ "Williamsburg", "D. Duck", "1600" ],
		[ "Queensborough", "Palmer & Hornbostel", "1182" ],
		[ "Triborough", "O. H. Ammann", "1380,383" ],
		[ "Bronx Whitestone", "O. H. Ammann", "2300" ],
		[ "Throgs Neck", "O. H. Ammann", "1800" ],
		[ "George Washington", "O. H. Ammann", "3500" ],
		[ "Spamspan", "S. Spamington", "10000" ]
	];

      var data2 =
	[
		[ "bridge", "designer", "length" ],
		[ "Brooklyn", "J. A. Roebling", "1595" ],
		[ "Manhattan", "G. Lindenthal", "1470" ],
		[ "Williamsburg", "L. L. Buck", "1600" ],
		[ "Queensborough", "Palmer & Hornbostel", "1182" ],
		[ "Triborough", "O. H. Ammann", "1380,383" ],
		[ "Bronx Whitestone", "O. H. Ammann", "2300" ],
		[ "Throgs Neck", "O. H. Ammann", "1800" ],
		[ "George Washington", "O. H. Ammann", "3500" ]
	];

      $('#table0').handsontable({
        data: data0,
        minRows: 5,
        minCols: 6,
        minSpareRows: 1,
        autoWrapRow: true,
        colHeaders: true,
        contextMenu: true,
        onChange: function(changes,source) { processChange(changes,source,'table1'); }
      });

      $('#table1').handsontable({
        data: data1,
        minRows: 5,
        minCols: 6,
        minSpareRows: 1,
        autoWrapRow: true,
        colHeaders: true,
        contextMenu: true,
        onChange: function(changes,source) { processChange(changes,source,'table1'); }
      });

      $('#table2').handsontable({
        data: data2,
        minRows: 5,
        minCols: 6,
        minSpareRows: 1,
        autoWrapRow: true,
        colHeaders: true,
        contextMenu: true,
        onChange: function(changes,source) { processChange(changes,source,'table2'); }
      });

$("#parent_checkbox").click(function() {
  use_parent = $("#parent_checkbox")[0].checked;
  if (use_parent) {
    $("#block0").show();
  } else {
    $("#block0").hide();
  }
  processChange(null,null,null);
  return true;
});

$("#button-clear").click(function() {
  data0.length = 1;
  data0[0] = [""];
  data1.length = 1;
  data1[0] = [""];
  data2.length = 1;
  data2[0] = [""];
  $('#table0').handsontable('render');
  $('#table1').handsontable('render');
  $('#table2').handsontable('render');
  return false;
})
</script>

</body>
</html>

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>daff - data diffs in javascript, ruby, python, php, ...</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="lib/jquery.min.js"></script>
        <script src="dist/jquery.handsontable.full.js"></script>
        <script src="daff.js"></script>
        <script src="daff_handsontable.js"></script>
        <script src="test_data.js"></script>
        <link rel="stylesheet" media="screen" href="dist/jquery.handsontable.full.css">
        <link rel="stylesheet" media="screen" href="daff.css">
        <link rel="stylesheet" media="screen" href="daff_handsontable.css">
    </head>

    <body>

        <div class="top-info">

            <div class="source-link">
                <a class="github-button" href="https://github.com/paulfitz/daff" data-count-href="/paulfitz/daff/stargazers" data-count-api="/repos/paulfitz/daff#stargazers_count">Github</a>
            </div>

            
            <h1>daff</h1>

            <p class="explain">
                Ever wanted to compare tables as easily as you compare code?
                <tt class="daff">daff</tt> (think &ldquo;data diff&rdquo;) is for you.
            </p>

        </div>


        <div id="content">

            <div class="section">


                <h2>Live example</h2>
                
                <div id="controls">
                    &nbsp; &nbsp; <a href="#" id="control-item-config" class="control-item control-menu" data-item="item-config"><b>&equiv;</b></a>
                    <a href="#" id="control-item-parent" class="control-item" data-item="item-parent" style="display: none;">Ancestor</a>
                    <a href="#" id="control-item-before" class="control-item" data-item="item-before">Original<span class="verbosity"> table</span></a>
                    <a href="#" id="control-item-after" class="control-item" data-item="item-after">Modified<span class="verbosity">  table</span></a>
                    <a href="#" id="control-item-diff" class="control-item" data-item="item-diff">Diff<span class="verbosity">erence</span></a>
                </div>

                <div id="main">

                    <div id="items">

                        <div id="item-config" class="item">
                            <form class="demo-options">
                                <span class="unit"><input id="parent_checkbox" type="checkbox" /><label for="parent_checkbox">Use 3-way comparison</label></span>
                                <span class="unit"><input id="order_checkbox" type="checkbox" /><label for="order_checkbox">Show row/column numbers</label></span>
                                <span class="unit"><input type=button id="button-clear" value="clear all cells" /></span>
                            </form>
                        </div>

                        <div id="item-parent" class="item">
                            <div id="table0" class="tabular"></div>
                            <div class="explain">
                                You can edit this table. The <a class="show-item" data-item="item-diff" href="#">difference</a> will be recalculated immediately.  This table should be a common ancestor for the <a class="show-item" data-item="item-before" href="#">&ldquo;original&rdquo; table</a> and the <a class="show-item" data-item="item-after" href="#">modified table</a>.
                            </div>
                        </div>
                        
                        <div id="item-before" class="item">
                            <div id="table1" class="tabular"></div>
                            <div class="explain">
                                You can edit this table. The <a class="show-item" data-item="item-diff" href="#">difference</a> will be recalculated immediately.  We are using this as the original version of the table.  The difference will show the changes that were made in the <a class="show-item" data-item="item-after" href="#">modified table</a>.
                            </div>
                        </div>
                        <div id="item-after" class="item">
                            <div id="table2" class="tabular"></div>
                            <div class="explain">
                                You can edit this table. The <a class="show-item" data-item="item-diff" href="#">difference</a> will be recalculated immediately.  The difference will show the changes that were made in this table with respect to the <a class="show-item" data-item="item-before" href="#">original table</a>.
                            </div>
                        </div>
                        <div id="item-diff" class="item">
                            <div id="diff" class="highlighter tabular"></div>
                            <div class="explain">
                                <p>This shows the changes made in the <a class="show-item" data-item="item-after" href="#">modified table</a> with respect to the <a class="show-item" data-item="item-before" href="#">original table</a>.  The format used is the <a href="https://paulfitz.github.io/daff-doc/spec.html">highlighter tabular diff</a>.</p>
                                <p>You can collapse the diff down to nothing by
                                    <a href="#" id="apply-diff">applying it to the original table</a>.
                                    More usefully, you can edit the diff first before applying it.  Erasing
                                    cells like &ldquo;<span class="plus">+++</span>&rdquo; or 
                                    &ldquo;<span class="minus">---</span>&rdquo; means those changes won't get applied.
                                </p>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Installation</h2>

                <div class='terminal'>
                    <div class='snip snip-alt'>npm install daff -g</div>
                    <div class='snip snip-alt'>pip install daff</div>
                    <div class='snip snip-alt'>gem install daff</div>
                    <div class='snip'>composer require paulfitz/daff-php</div>
                </div>

                <p class="explain">
                    For more options and languages, see <a href="https://github.com/paulfitz/daff">github repository</a>.
                </p>
            </div>

            <div class="section">
                <h2>Using with git</h2>

                <p class="explain">

                    Do you have a git repository with <tt>.csv</tt> files in it?  You
                    can make git diffs and merges table-aware using <tt>daff</tt>.
                    To set this up, run:

                </p>

                <div class="terminal">
                    <div class="snip">daff git csv</div>
                </div>

                <p class="explain">
                    Your CSV diffs and merges will get smarter,
                    since git will suddenly understand about rows and columns, not just lines:
                </p>

                <a href="https://paulfitz.github.io/daff-doc/images/daff_vs_diff.png"><img src="https://paulfitz.github.io/daff-doc/images/daff_vs_diff.png" style="width: 450px;" /></a>

                <p class="explain">
                  You can get the same results online on github using
                  <s><a href="http://floppy.org.uk/">Floppy</a>'s <a href="https://github.com/theodi/csvhub">csvhub</a> chrome extension (no longer available)</s>
                  the <a href="https://chrome.google.com/webstore/detail/github-csv-diff/ngpdjmibpbemokfbmapemhpbmgacebhg/">Github CSV Diff chrome extension by WeiYang</a> at <a href="https://github.com/wy-z/github-csv-diff">/wy-z/github-csv-diff</a>. 
                </p>
            </div>

            <div class="section">
                <h2>Help</h2>

                <p class="explain">
                    Make sure to read the <a href="https://github.com/paulfitz/daff/blob/master/README.md">README</a>.
                    Then just file an issue or <a href="https://twitter.com/fitzyfitzyfitzy">@fitzyfitzyfitzy</a> me, I'll be excited to hear from you.
                </p>

            </div>

        </div>

<script>
$(function() {

   function showItem(name) {
     $(".item").each(function() {
       $(this).hide();
     });
     $("#" + name).show();
     $(".control-item").each(function() {
       $(this).removeClass('control-item-active');
     });
     $("#control-" + name).addClass('control-item-active');
     $("#control-" + name).removeClass('control-item-mod');
   }

   function flagItem(name) {
     if (!$("#control-" + name).hasClass('control-item-active')) {
       $("#control-" + name).addClass('control-item-mod');
     }
   }

   $(".control-item").each(function() {
     var self = $(this);
     self.click(function() {
       showItem(self.data("item"));
       return false;
     });
   });
   $(".show-item").each(function() {
     var self = $(this);
     self.click(function() {
       showItem(self.data("item"));
       return false;
     });
   });
   showItem("item-diff");

   function load_table(t,data) {
     t.length = 0;
     for (var i=0; i < data.length; i++) {
       t[i] = data[i].slice();
     }
   }

   var use_parent = false;
   var show_order = false;
   function processChange(changes,source,table) {
     if (source=="loadData") return;
     var t1 = new daff.TableView(data1);
     var t2 = new daff.TableView(data2);
     t1.trim();
     t2.trim();
     var ct = null;
     if (!use_parent) { 
       ct = daff.compareTables(t1,t2);
     } else {
       var t0 = new daff.TableView(data0);
       t0.trim();
       ct = daff.compareTables3(t0,t1,t2);
     }
     var align = ct.align();
     var output = new daff.TableView([]);
     var flags = new daff.CompareFlags();
     flags.show_unchanged = false;
     flags.always_show_header = true;
     if (show_order) {
       flags.never_show_order = false;
       flags.always_show_order = true;
     }
     (new daff.TableDiff(align,flags)).hilite(output);
     data_diff = output.data;
     $("#diff").handsontable('loadData',output.data);
     flagItem("item-diff");
   }

   var data_diff =  [
     [ "" ]
   ];

   var example = all_examples[0];

   var data0 = [];
   var data1 = [];
   var data2 = [];
   load_table(data0,example["parent"]);
   load_table(data1,example["local"]);
   load_table(data2,example["remote"]);

   function headerPromptRenderer(instance, td, row, col, prop, value, cellProperties) {
     Handsontable.TextCell.renderer.apply(this, arguments);
     if (row==0) {
       td.className = 'header';
     }
   }

   $('#table0').handsontable({
     data: data0,
     minRows: 5,
     minCols: 6,
     minSpareRows: 1,
     autoWrapRow: true,
     colHeaders: false,
     contextMenu: true,
     height: 200,
     asyncRendering: false,
     onChange: function(changes,source) { processChange(changes,source,'table1'); },
     cells: function (row, col, prop) {
       var cellProperties = {};
       cellProperties.type = {
	 renderer: headerPromptRenderer
       }
       return cellProperties;
     }
   });

   $('#table1').handsontable({
     data: data1,
     minRows: 5,
     minCols: 6,
     minSpareRows: 1,
     autoWrapRow: true,
     colHeaders: false,
     contextMenu: true,
     height: 200,
     asyncRendering: false,
     onChange: function(changes,source) { processChange(changes,source,'table1'); },
     cells: function (row, col, prop) {
       var cellProperties = {};
       cellProperties.type = {
	 renderer: headerPromptRenderer
       }
       return cellProperties;
     }
   });

   $('#table2').handsontable({
     data: data2,
     minRows: 5,
     minCols: 6,
     minSpareRows: 1,
     autoWrapRow: true,
     colHeaders: false,
     contextMenu: true,
     height: 200,
     asyncRendering: false,
     onChange: function(changes,source) { processChange(changes,source,'table2'); },
     cells: function (row, col, prop) {
       var cellProperties = {};
       cellProperties.type = {
	 renderer: headerPromptRenderer
       }
       return cellProperties;
     }
   });

   $('#diff').handsontable({
     data: data_diff,
     minRows: 1,
     minCols: 1,
     minSpareCols: 0,
     minSpareRows: 0,
     autoWrapRow: true,
     colHeaders: false,
     //contextMenu: true,
     //height: 300,
     asyncRendering: false,
     cells: function (row, col, prop) {
       var cellProperties = {};
       cellProperties.type = {
	 renderer: daff.diffRenderer
       }
       return cellProperties;
     }
   });
   processChange(null,null,null);

   $("#parent_checkbox").click(function() {
     use_parent = $("#parent_checkbox")[0].checked;
     if (use_parent) {
       $("#control-item-parent").show();
     } else {
       $("#control-item-parent").hide();
       $("#item-parent").hide();
     }
     processChange(null,null,null);
     flagItem("item-parent");
     return true;
   });

   $("#order_checkbox").click(function() {
     show_order = $("#order_checkbox")[0].checked;
     processChange(null,null,null);
     return true;
   });

   function clear_table(t) {
     t.length = 0;
     t[0] = ["A","B","C"];
     t[1] = ["","",""];
     t[2] = ["","",""];
   }

   $("#button-clear").click(function() {
     clear_table(data0);
     clear_table(data1);
     clear_table(data2);
     $('#table0').handsontable('render');
     $('#table1').handsontable('render');
     $('#table2').handsontable('render');
     processChange(null,null,null);
     flagItem("item-before");
     flagItem("item-after");
     flagItem("item-parent");
     return false;
   });

   $("#apply-diff").click(function() {
     var t1 = new daff.TableView(data1);
     t1.trim();
     var patch = new daff.TableView(data_diff);
     patch.trim();
     var patcher = new daff.HighlightPatch(t1,patch);
     patcher.apply();
     if (use_parent) {
       var t1 = new daff.TableView(data0);
       t1.trim();
       var patch = new daff.TableView(data_diff);
       patch.trim();
       var patcher = new daff.HighlightPatch(t1,patch);
       patcher.apply();
       $('#table0').handsontable('render');
     }
     $('#table1').handsontable('render');
     processChange(null,null,null);
     flagItem("item-before");
     return false;
   });

   for (var i=0; i < all_examples.length; i++) {
     var example = all_examples[i];
     var id = "set_example_" + example["key"];
     $(".demo-options").append("<span class='unit example'><input type=button id='" + id + "' value='" + example["key"] + " example' /></span>");
     $("#" + id).click((function(example,id) { return function() {
       load_table(data0,example["parent"]);
       load_table(data1,example["local"]);
       load_table(data2,example["remote"]);
       $('#table0').handsontable('render');
       $('#table1').handsontable('render');
       $('#table2').handsontable('render');
       processChange(null,null,null);
       showItem("item-diff");
       flagItem("item-before");
       flagItem("item-after");
       flagItem("item-parent");
       return false; 
     }})(example,id));
   }
});

</script>

<script async defer id="github-bjs" src="buttons.js"></script>

    </body>
</html>

<html>
<head>
<title>coopyhx - diff tables in javascript</title>
<script src="lib/jquery.min.js"></script>
<script src="dist/jquery.handsontable.full.js"></script>
<script src="coopy/coopy.js"></script>
<script src="coopy/scripts/jtable.js"></script>
<link rel="stylesheet" media="screen" href="dist/jquery.handsontable.full.css">
<link rel="stylesheet" media="screen" href="coopyhx.css">
</head>

<body>

<table id="pane-collection">

  <tr>
    <td id="table-pane">
      <div class="pane-show">
	<p>
	This a test of <a href="https://github.com/paulfitz/coopyhx">coopyhx</a>, for comparing tables. Edit tables below, see diffs.
	</p>
	<form>
	  Options: <input id="parent_checkbox" type="checkbox" />3-way comparison /
	  <a id="button-clear" href="#">Clear all cells</a>
	</form>
	<div id="block0" style="display: none;">
	  <h3>Parent</h3>
	  <div id="table0"></div>
	</div>
	<div id="block1">
	  <h3>Local</h3>
	  <div id="table1"></div>
	</div>
	<div id="block2">
	  <h3>Remote</h3>
	  <div id="table2"></div>
	</div>
      </div>
    </td>
    
    <td id="result-pane">
      <div class="pane-show">
	<h3>Highlighter difference</h3>
	<div id="diff"></div>
	<h3>Row alignment</h3>
	<div id="ordering"></div>
	<h3>Column alignment</h3>
	<div id="column_ordering"></div>
      </div>
    </td>
  </tr>

</table>


<script>
var jtable = window;
var use_parent = false;
function processChange(changes,source,table) {
  var t1 = new jtable.JTable2(data1);
  var t2 = new jtable.JTable2(data2);
  t1.trim();
  t2.trim();
  var ct = null;
  if (!use_parent) { 
    ct = coopy.Coopy.compareTables(t1,t2);
  } else {
    var t0 = new jtable.JTable2(data0);
    t0.trim();
    ct = coopy.Coopy.compareTables3(t0,t1,t2);
  }
  var align = ct.align();
  var order = align.toOrder();
  var report = order.toString().replace(/, */g,"<br />\n");
  $("#ordering").html(report);
  var report2 = align.meta.toOrder().toString().replace(/, */g,"<br />\n");
  $("#column_ordering").html(report2);
  var output = new jtable.JTable2([]);
  var flags = new coopy.CompareFlags();
  flags.show_unchanged = false;
  flags.always_show_header = true;
  (new coopy.TableDiff(align,flags)).hilite(output);
  var render = new coopy.DiffRender();
  render.render(output);
  $("#diff").html(render.html());
}


      var data0 = 
	[
		[ "bridge", "designer", "length" ],
		[ "Brooklyn", "J. A. Roebling", "1595" ],
		[ "Williamsburg", "D. Duck", "1600" ],
		[ "Queensborough", "Palmer & Hornbostel", "1182" ],
		[ "Triborough", "O. H. Ammann", "1380,383" ],
		[ "Bronx Whitestone", "O. H. Ammann", "2300" ],
		[ "Throgs Neck", "O. H. Ammann", "1800" ],
		[ "George Washington", "O. H. Ammann", "3500" ],
		[ "Spamspan", "S. Spamington", "10000" ]
	];

      var data1 =
	[
		[ "bridge", "designer", "length" ],
		[ "Brooklyn", "J. A. Roebling", "1595" ],
		[ "Williamsburg", "D. Duck", "1600" ],
		[ "Queensborough", "Palmer & Hornbostel", "1182" ],
		[ "Triborough", "O. H. Ammann", "1380,383" ],
		[ "Bronx Whitestone", "O. H. Ammann", "2300" ],
		[ "Throgs Neck", "O. H. Ammann", "1800" ],
		[ "George Washington", "O. H. Ammann", "3500" ],
		[ "Spamspan", "S. Spamington", "10000" ]
	];

      var data2 =
	[
		[ "bridge", "designer", "length" ],
		[ "Brooklyn", "J. A. Roebling", "1595" ],
		[ "Manhattan", "G. Lindenthal", "1470" ],
		[ "Williamsburg", "L. L. Buck", "1600" ],
		[ "Queensborough", "Palmer & Hornbostel", "1182" ],
		[ "Triborough", "O. H. Ammann", "1380,383" ],
		[ "Bronx Whitestone", "O. H. Ammann", "2300" ],
		[ "Throgs Neck", "O. H. Ammann", "1800" ],
		[ "George Washington", "O. H. Ammann", "3500" ]
	];

      $('#table0').handsontable({
        data: data0,
        minRows: 5,
        minCols: 6,
        minSpareRows: 1,
        autoWrapRow: true,
        colHeaders: true,
        contextMenu: true,
        onChange: function(changes,source) { processChange(changes,source,'table1'); }
      });

      $('#table1').handsontable({
        data: data1,
        minRows: 5,
        minCols: 6,
        minSpareRows: 1,
        autoWrapRow: true,
        colHeaders: true,
        contextMenu: true,
        onChange: function(changes,source) { processChange(changes,source,'table1'); }
      });

      $('#table2').handsontable({
        data: data2,
        minRows: 5,
        minCols: 6,
        minSpareRows: 1,
        autoWrapRow: true,
        colHeaders: true,
        contextMenu: true,
        onChange: function(changes,source) { processChange(changes,source,'table2'); }
      });

$("#parent_checkbox").click(function() {
  use_parent = $("#parent_checkbox")[0].checked;
  if (use_parent) {
    $("#block0").show();
  } else {
    $("#block0").hide();
  }
  processChange(null,null,null);
  return true;
});

$("#button-clear").click(function() {
  data0.length = 1;
  data0[0] = [""];
  data1.length = 1;
  data1[0] = [""];
  data2.length = 1;
  data2[0] = [""];
  $('#table0').handsontable('render');
  $('#table1').handsontable('render');
  $('#table2').handsontable('render');
  return false;
})
</script>

</body>
</html>
